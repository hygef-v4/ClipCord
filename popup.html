<!DOCTYPE html>
<html>
<head>
    <title>Discord Clip Downloader</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="popup.css" rel="stylesheet"> <!-- Link your CSS -->
    <style>
        body {
            min-width: 380px; /* Prevent popup from being too small */
            padding: 1rem;
        }
        .clip-name {
            margin-left: 10px;
            flex-grow: 1; /* Allow text to take available space */
            min-width: 0; /* Important for text-truncate */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .list-group-item video {
            flex-shrink: 0; /* Prevent video from shrinking */
            object-fit: cover; /* Cover the area */
        }
        .btn-download-single {
            margin-left: auto; /* Push button to the right */
            flex-shrink: 0;
        }

        /* --- Styling for the loading overlay --- */
        #videoListContainer {
            position: relative; /* Needed for absolute positioning of overlay */
            min-height: 50px; /* Give it some height even when empty */
            margin-top: 1rem; /* Add space above the list */
        }

        #loadingOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8); /* Semi-transparent white */
            backdrop-filter: blur(4px); /* Apply blur effect */
            -webkit-backdrop-filter: blur(4px); /* Safari support */
            z-index: 10; /* Ensure it's on top of the list */
            display: flex; /* Use flex to center potential spinner/text */
            justify-content: center;
            align-items: center;
            opacity: 0; /* Start hidden */
            pointer-events: none; /* Allow interaction when hidden */
            transition: opacity 0.5s ease-in-out; /* Smooth fade */
            border-radius: 0.375rem; /* Match list group border radius */
        }

        #loadingOverlay.active {
            opacity: 1; /* Make visible */
            pointer-events: auto; /* Block interaction */
        }
        /* Optional: Spinner inside the overlay */
        #loadingOverlay .spinner-border {
             width: 2rem;
             height: 2rem;
        }

        /* Ensure Download All section has margin */
         #downloadAllSection {
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
            padding: 0.75rem;
            border: 1px solid #dee2e6; /* Optional: Add border like an alert */
            border-radius: 0.375rem;
            background-color: #f8f9fa; /* Light background */
         }

    </style>
</head>
<body>
    <div class="container-fluid">
        <h5 class="mb-3">Discord Clip Downloader</h5>

        <div class="mb-3">
             <label for="folderNameInput" class="form-label">Download Folder Name:</label>
             <input type="text" class="form-control form-control-sm" id="folderNameInput" placeholder="DiscordClips">
        </div>

        <button id="scanButton" class="btn btn-primary w-100 mb-2">
            <span id="spinner" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
            Scan Current Channel
        </button>

        <div id="statusMessage" class="alert alert-light mb-2 d-none" role="alert">
            Click 'Scan' to find clips.
        </div>

        <!-- ### MODIFICATION: Moved Download All Section HERE ### -->
        <div id="downloadAllSection" class="d-none text-center"> <!-- Added text-center -->
            <p class="mb-2">Total Clips Found: <strong id="totalClipCount">0</strong></p> <!-- Made count bold, reduced margin -->
            <button id="downloadAllButton" class="btn btn-success w-100 btn-sm">Download All</button> <!-- Added btn-sm -->
        </div>
        <!-- ### END MODIFICATION ### -->


        <!-- Wrapper for the list and overlay -->
        <div id="videoListContainer" class="d-none">
            <div id="videoListArea" class="list-group" style="max-height: 300px; overflow-y: auto;"> <!-- Removed mb-3 from here -->
                <!-- Video items will be added here by JS -->
            </div>
            <!-- The overlay -->
            <div id="loadingOverlay">
                 <!-- Optional: You can add a spinner here too -->
                 <div class="spinner-border text-secondary" role="status">
                    <span class="visually-hidden">Loading Previews...</span>
                 </div>
            </div>
        </div>

    </div> <!-- End container-fluid -->

    <script src="popup.js"></script>
</body>
</html>