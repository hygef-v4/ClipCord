<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord Clip Downloader</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Embedded Custom CSS -->
    <style>
        /* General Body & Font Styling */
        body {
            min-width: 380px; /* Minimum width for usability */
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            color: #333;
            background-color: #fdfdfd; /* Slightly off-white background */
        }

        .popup-container {
            padding: 1rem; /* Consistent padding */
        }

        .main-title {
            color: #5865F2; /* Discord-like purple */
            font-weight: 600;
        }

        /* Folder Input Label */
        .folder-label {
            font-size: 0.9rem;
            font-weight: 500;
            color: #555;
        }

        /* Scan Button Styling */
        .btn-scan .button-text {
            margin-left: 5px;
        }

        /* Status Message Styling */
        .status-message {
            font-size: 0.9rem;
            text-align: center;
            padding: 0.5rem 0.75rem;
        }

        /* Download All Section Styling */
        .download-all-box {
            margin-top: 0.75rem;
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            border: 1px solid #e0e0e0; /* Lighter border */
            border-radius: 0.375rem; /* Standard Bootstrap radius */
            background-color: #f8f9fa; /* Light grey background */
        }

        .clip-count-text {
            font-size: 0.95rem;
            color: #444;
        }

        /* Video List Container & Scroll */
        #videoListContainer {
            position: relative; /* For overlay positioning */
            min-height: 50px;
            margin-top: 1rem; /* Space above the list */
            border: 1px solid #e0e0e0; /* Border around the list container */
            border-radius: 0.375rem;
            overflow: hidden; /* Ensure overlay blur doesn't leak */
        }

        .video-list-scroll {
            max-height: 300px; /* Max height before scrolling */
            overflow-y: auto; /* Enable vertical scroll */
            border-radius: 0.375rem; /* Match container radius */
        }

        /* Individual Video List Item Styling */
        .list-group-item {
            /* Remove default borders if container has one */
            border: none;
            border-bottom: 1px solid #eee; /* Subtle separator */
            padding: 0.75rem 1rem; /* Adjust padding */
            transition: background-color 0.2s ease-in-out; /* Smooth hover transition */
        }

        .list-group-item:last-child {
            border-bottom: none; /* Remove border from last item */
        }

        /* --- Hover Effect for List Items --- */
        .list-group-item:hover {
            background-color: #f1f3f5; /* Lighter hover background */
            cursor: pointer; /* Indicate interactivity */
        }

        /* Video Thumbnail Styling */
        .list-group-item video {
            flex-shrink: 0; /* Prevent shrinking */
            object-fit: cover; /* Cover the 80x45 area */
            border-radius: 4px; /* Slightly rounded corners */
            border: 1px solid #dee2e6; /* Subtle border */
            /* Background color added via JS */
        }

        /* Clip Filename Styling */
        .clip-name {
            margin-left: 12px; /* Space between video and text */
            flex-grow: 1; /* Allow text to take available space */
            min-width: 0; /* Necessary for text-truncate */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 0.9rem;
            color: #333;
            vertical-align: middle; /* Helps align with button/video */
        }

        /* Download Button Alignment */
        .btn-download-single {
            margin-left: auto; /* Push to the right */
            flex-shrink: 0; /* Prevent shrinking */
        }

        /* Loading Overlay Styling */
        #loadingOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.85); /* Slightly more opaque white */
            backdrop-filter: blur(4px); /* Keep the blur effect */
            -webkit-backdrop-filter: blur(4px); /* Safari support */
            z-index: 10; /* Ensure it's on top */
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease-in-out; /* Smooth fade */
            border-radius: 0.375rem; /* Match container */
        }

        #loadingOverlay.active {
            opacity: 1;
            pointer-events: auto; /* Block interaction when active */
        }

        #loadingOverlay .spinner-border {
            width: 2rem; /* Adjust spinner size if needed */
            height: 2rem;
        }
    </style>

</head>
<body>
    <div class="container-fluid popup-container">
        <h5 class="mb-3 text-center main-title">Discord Clip Downloader</h5>

        <!-- Folder Input Section -->
        <div class="mb-3">
             <label for="folderNameInput" class="form-label folder-label">Download Folder Name:</label>
             <input type="text" class="form-control form-control-sm" id="folderNameInput" placeholder="DiscordClips">
        </div>

        <!-- Scan Button -->
        <button id="scanButton" class="btn btn-primary w-100 mb-2 btn-scan">
            <span id="spinner" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
            <span class="button-text">Scan Current Channel</span>
        </button>

        <!-- Status Message Area -->
        <div id="statusMessage" class="alert alert-light mb-2 status-message d-none" role="alert">
            Click 'Scan' to find clips.
        </div>

        <!-- Download All Section (Moved Up) -->
        <div id="downloadAllSection" class="d-none text-center download-all-box">
            <p class="mb-2 clip-count-text">Total Clips Found: <strong id="totalClipCount">0</strong></p>
            <button id="downloadAllButton" class="btn btn-success w-100 btn-sm">Download All</button>
        </div>

        <!-- Video List Area with Overlay -->
        <div id="videoListContainer" class="d-none"> <!-- Initially hidden -->
            <!-- The List Itself -->
            <div id="videoListArea" class="list-group video-list-scroll">
                <!-- Video items will be dynamically added here by JS -->
            </div>
            <!-- Loading Overlay -->
            <div id="loadingOverlay">
                 <div class="spinner-border text-secondary" role="status">
                    <span class="visually-hidden">Loading Previews...</span>
                 </div>
            </div>
        </div>

    </div> <!-- End container-fluid -->

    <!-- Popup JavaScript -->
    <script src="popup.js"></script>
</body>
</html>